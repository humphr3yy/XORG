(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();class T{position;velocity;radius;shouldRemove=!1;constructor(t,e,i){this.position={x:t,y:e},this.velocity={x:0,y:0},this.radius=i}}class C{ctx;constructor(t){this.ctx=t}drawArena(t,e){this.ctx.beginPath(),this.ctx.arc(0,0,t,0,Math.PI*2),this.ctx.lineWidth=5,e?(this.ctx.strokeStyle="#ff8800",this.ctx.shadowBlur=20,this.ctx.shadowColor="#ff8800"):(this.ctx.strokeStyle="#fff",this.ctx.shadowBlur=10,this.ctx.shadowColor="#fff"),this.ctx.stroke(),this.ctx.shadowBlur=0}drawPlayer(t,e,i,s,o,n,a=!1,r=!1){this.ctx.save(),this.ctx.translate(t,e),this.ctx.rotate(o-Math.PI/2),r?(this.ctx.shadowBlur=30,this.ctx.shadowColor="#ff4400"):(this.ctx.shadowBlur=15,this.ctx.shadowColor=s),this.ctx.beginPath(),this.ctx.arc(0,0,i,0,Math.PI*2),this.ctx.fillStyle=s,this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.fillStyle="white";const h=12,c=20;if(this.ctx.fillRect(-h/2,i-5,h,c),n>0){this.ctx.fillStyle="#ffaa00";const u=c*n;this.ctx.fillRect(-h/2,i-5+(c-u),h,u)}this.ctx.restore(),a&&this.drawCrown(t,e-i-20)}drawCrown(t,e){this.ctx.fillStyle="#ffd700",this.ctx.shadowBlur=10,this.ctx.shadowColor="#ffd700",this.ctx.beginPath(),this.ctx.moveTo(t-10,e+5),this.ctx.lineTo(t-7,e-5),this.ctx.lineTo(t-4,e+2),this.ctx.lineTo(t,e-10),this.ctx.lineTo(t+4,e+2),this.ctx.lineTo(t+7,e-5),this.ctx.lineTo(t+10,e+5),this.ctx.closePath(),this.ctx.fill(),this.ctx.shadowBlur=0}drawProjectile(t,e,i){this.ctx.save(),this.ctx.translate(t,e),this.ctx.rotate(i);const s=8;this.ctx.fillStyle="#fff",this.ctx.shadowBlur=10,this.ctx.shadowColor="#fff",this.ctx.fillRect(-s/2,-s/2,s,s),this.ctx.restore()}}class S extends T{ownerId;angle;speed=800;constructor(t,e,i,s){super(t,e,5),this.ownerId=s,this.angle=i,this.velocity={x:Math.cos(i)*this.speed,y:Math.sin(i)*this.speed}}update(t){this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t}draw(t){t.drawProjectile(this.position.x,this.position.y,this.angle)}}class p extends T{game;id;color;isAI;inputMethod;isWinner=!1;hp=10;angle=0;canShoot=!0;overheat=0;isOverheated=!1;timeSinceLastShot=0;overheatCooldown=3;drainDelay=.5;drainRate=.5;accelerationWindow=0;recoilForce=150;accelerationMultiplier=2;constructor(t,e,i,s=!1,o="keyboard-mouse"){super(0,0,20),this.game=t,this.id=e,this.color=i,this.isAI=s,this.inputMethod=o}update(t){if(this.hp<=0)return;this.isAI?this.updateAI(t):this.handleInput(),this.accelerationWindow>0&&(this.accelerationWindow-=t),this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.timeSinceLastShot+=t,this.isOverheated?(this.overheat-=t/this.overheatCooldown,this.overheat<=0&&(this.overheat=0,this.isOverheated=!1)):this.timeSinceLastShot>this.drainDelay&&this.overheat>0&&(this.overheat-=this.drainRate*t,this.overheat<0&&(this.overheat=0));const e=50,i=Math.sqrt(this.velocity.x**2+this.velocity.y**2);if(i<e)if(i===0){const s=Math.random()*Math.PI*2;this.velocity.x=Math.cos(s)*e,this.velocity.y=Math.sin(s)*e}else{const s=e/i;this.velocity.x*=s,this.velocity.y*=s}}wasShooting=!1;handleInput(){if(this.inputMethod==="keyboard-mouse"){this.angle=this.game.inputManager.getMouseAngle(this.position.x,this.position.y);const t=this.game.inputManager.isMouseDown;t&&!this.wasShooting&&this.shoot(),this.wasShooting=t}else if(this.inputMethod==="controller"){const t=this.game.inputManager.getControllerInput(this.id);t?(this.angle=t.angle,t.shoot&&!this.wasShooting&&this.shoot(),this.wasShooting=t.shoot):this.wasShooting=!1}}updateAI(t){const e=this.game.players[0];if(e.hp>0){const i=e.position.x-this.position.x,s=e.position.y-this.position.y;this.angle=Math.atan2(s,i),!this.isOverheated&&Math.random()<.02&&this.shoot()}}shoot(){if(this.hp<=0||!this.canShoot||this.isOverheated||this.game.isSuddenDeath)return;const t=this.radius+10,e=this.position.x+Math.cos(this.angle)*t,i=this.position.y+Math.sin(this.angle)*t;this.game.projectiles.push(new S(e,i,this.angle,this.id)),this.game.soundManager.playShoot();const s=-Math.cos(this.angle)*this.recoilForce,o=-Math.sin(this.angle)*this.recoilForce;this.velocity.x+=s,this.velocity.y+=o,this.accelerationWindow=.15,this.overheat+=.08,this.timeSinceLastShot=0,this.overheat>=1&&(this.overheat=1,this.isOverheated=!0,this.game.soundManager.playOverheat())}takeDamage(t){this.game.isSuddenDeath||(this.hp-=t,this.hp<0&&(this.hp=0),this.game.soundManager.playHit())}draw(t){if(this.hp<=0)return;let e=this.overheat;!this.isOverheated&&this.timeSinceLastShot>this.drainDelay&&(e=0),t.drawPlayer(this.position.x,this.position.y,this.radius,this.color,this.angle,e,this.isWinner,this.isOverheated)}switchToAI(){this.isAI=!0,this.inputMethod="ai",console.log(`Player ${this.id} switched to AI mode`)}switchToHuman(t){this.isAI=!1,this.inputMethod=t,console.log(`Player ${this.id} switched to human mode (${t})`)}}class I{game;constructor(t){this.game=t}checkCollisions(){if(this.game.players.forEach(t=>this.checkWallCollision(t)),this.game.players.length>=2)for(let t=0;t<this.game.players.length;t++)for(let e=t+1;e<this.game.players.length;e++)this.checkPlayerCollision(this.game.players[t],this.game.players[e]);this.game.projectiles.forEach(t=>{Math.sqrt(t.position.x**2+t.position.y**2)+t.radius>=this.game.arenaRadius&&(t.shouldRemove=!0),this.game.players.forEach(i=>{if(t.ownerId!==i.id&&i.hp>0){const s=i.position.x-t.position.x,o=i.position.y-t.position.y;Math.sqrt(s*s+o*o)<i.radius+t.radius&&(i.takeDamage(1),t.shouldRemove=!0)}})})}checkWallCollision(t){const e=Math.sqrt(t.position.x**2+t.position.y**2);if(e+t.radius>this.game.arenaRadius){if(this.game.isTiebreaker&&t instanceof p){this.game.endTiebreaker(t);return}if(this.game.isSuddenDeath&&t instanceof p){t.hp=0;return}const i=t.position.x/e,s=t.position.y/e,o=e+t.radius-this.game.arenaRadius;t.position.x-=i*o,t.position.y-=s*o;const n=t.velocity.x*i+t.velocity.y*s;n>0&&(t.velocity.x=t.velocity.x-2*n*i,t.velocity.y=t.velocity.y-2*n*s)}}checkPlayerCollision(t,e){if(t.hp<=0||e.hp<=0)return;const i=e.position.x-t.position.x,s=e.position.y-t.position.y,o=Math.sqrt(i*i+s*s);if(o<t.radius+e.radius){const n=t.radius+e.radius-o,a=i/o,r=s/o;t.position.x-=a*n*.5,t.position.y-=r*n*.5,e.position.x+=a*n*.5,e.position.y+=r*n*.5;const h=a,c=r,u=-c,g=h,y=t.velocity.x*u+t.velocity.y*g,f=e.velocity.x*u+e.velocity.y*g,x=t.velocity.x*h+t.velocity.y*c,w=e.velocity.x*h+e.velocity.y*c,d=1,m=1,v=(x*(d-m)+2*m*w)/(d+m),M=(w*(m-d)+2*d*x)/(d+m);t.velocity.x=u*y+h*v,t.velocity.y=g*y+c*v,e.velocity.x=u*f+h*M,e.velocity.y=g*f+c*M}}}class k{game;mousePos={x:0,y:0};isMouseDown=!1;keys=new Set;constructor(t){this.game=t,this.setupListeners()}setupListeners(){window.addEventListener("mousemove",t=>{const e=this.game.canvas.getBoundingClientRect();this.mousePos.x=t.clientX-e.left,this.mousePos.y=t.clientY-e.top}),window.addEventListener("mousedown",()=>{this.isMouseDown=!0}),window.addEventListener("mouseup",()=>{this.isMouseDown=!1}),window.addEventListener("keydown",t=>{this.keys.add(t.code)}),window.addEventListener("keyup",t=>{this.keys.delete(t.code)})}getMouseAngle(t,e){const i=this.game.width/2,s=this.game.height/2,o=this.mousePos.x-i,n=this.mousePos.y-s,a=o-t,r=n-e;return Math.atan2(r,a)}getControllerInput(t){const e=navigator.getGamepads(),i=this.game.player1InputMethod==="controller";let s=null;if(t===1&&i?s=e[0]||null:t===2&&(i?s=e[1]||null:s=e[0]||null),s){const o=s.axes[0],n=s.axes[1];if(Math.abs(o)>.2||Math.abs(n)>.2){const a=Math.atan2(n,o),r=s.buttons[0]?.pressed||s.buttons[1]?.pressed;return{angle:a,shoot:r}}}return null}isControllerConnected(t){const e=navigator.getGamepads(),i=this.game.player1InputMethod==="controller";let s=null;return t===1&&i?s=e[0]||null:t===2&&(i?s=e[1]||null:s=e[0]||null),s!==null}}class E{audioContext;backgroundMusic=null;currentMusicType=null;constructor(){this.audioContext=new(window.AudioContext||window.webkitAudioContext)}playBackgroundMusic(t){if(this.currentMusicType===t&&this.backgroundMusic&&!this.backgroundMusic.paused)return;this.stopBackgroundMusic();const e=t==="menu"?"./menu.wav":"./XORG.wav";try{this.backgroundMusic=new Audio(e),this.backgroundMusic.loop=!0,this.backgroundMusic.volume=.8,this.backgroundMusic.volume=0,this.backgroundMusic.play().catch(i=>{console.warn("Failed to play background music (non-critical):",i)}),this.fadeIn(this.backgroundMusic,.5,1e3),this.currentMusicType=t}catch(i){console.warn("Failed to load background music (non-critical):",i)}}stopBackgroundMusic(){this.backgroundMusic&&(this.fadeOut(this.backgroundMusic,500,()=>{this.backgroundMusic&&(this.backgroundMusic.pause(),this.backgroundMusic.currentTime=0,this.backgroundMusic=null)}),this.currentMusicType=null)}fadeIn(t,e,i){const o=i/20,n=e/20;let a=0;const r=setInterval(()=>{if(a>=20||!t){clearInterval(r),t&&(t.volume=e);return}t.volume=Math.min(e,t.volume+n),a++},o)}fadeOut(t,e,i){const o=e/20,n=t.volume/20;let a=0;const r=setInterval(()=>{if(a>=20||!t){clearInterval(r),i&&i();return}t.volume=Math.max(0,t.volume-n),a++},o)}playShoot(){const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.audioContext.destination),t.frequency.setValueAtTime(800,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(200,this.audioContext.currentTime+.1),e.gain.setValueAtTime(.3,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),t.start(),t.stop(this.audioContext.currentTime+.1)}playHit(){const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="sawtooth",t.connect(e),e.connect(this.audioContext.destination),t.frequency.setValueAtTime(300,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(50,this.audioContext.currentTime+.2),e.gain.setValueAtTime(.4,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.2),t.start(),t.stop(this.audioContext.currentTime+.2)}playWin(){[523.25,659.25,783.99].forEach((e,i)=>{setTimeout(()=>{const s=this.audioContext.createOscillator(),o=this.audioContext.createGain();s.type="sine",s.connect(o),o.connect(this.audioContext.destination),s.frequency.value=e,o.gain.setValueAtTime(.3,this.audioContext.currentTime),o.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.4),s.start(),s.stop(this.audioContext.currentTime+.4)},i*150)})}playOverheat(){const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="triangle",t.connect(e),e.connect(this.audioContext.destination),t.frequency.setValueAtTime(400,this.audioContext.currentTime),t.frequency.setValueAtTime(600,this.audioContext.currentTime+.05),t.frequency.setValueAtTime(400,this.audioContext.currentTime+.1),e.gain.setValueAtTime(.2,this.audioContext.currentTime),e.gain.setValueAtTime(0,this.audioContext.currentTime+.15),t.start(),t.stop(this.audioContext.currentTime+.15)}}class P{canvas;ctx;width=0;height=0;lastTime=0;accumulator=0;step=1/60;renderer;physics;inputManager;soundManager;players=[];projectiles=[];arenaRadius=300;gameState="MENU";playerCount=1;isPlayer2AI=!0;scores={p1:0,p2:0};roundWinner=null;lastWinnerId=null;roundEndTimer=0;gameTimer=300;gameDuration=300;isTiebreaker=!1;player1InputMethod="keyboard-mouse";wasPlayer2ControllerConnected=!1;isSuddenDeath=!1;constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.renderer=new C(this.ctx),this.inputManager=new k(this),this.physics=new I(this),this.soundManager=new E,this.resize(),window.addEventListener("resize",()=>this.resize()),this.setupMenuListeners()}setupMenuListeners(){const t=document.getElementById("btn-1p"),e=document.getElementById("btn-2p");t?.addEventListener("click",()=>{const i=this.getSelectedDuration(),s=this.getSelectedInputMethod();this.startGame(1,i,s)}),e?.addEventListener("click",()=>{const i=this.getSelectedDuration(),s=this.getSelectedInputMethod();this.startGame(2,i,s)})}getSelectedDuration(){const t=document.querySelector('input[name="game-length"]:checked');return t?parseInt(t.value):300}getSelectedInputMethod(){return document.querySelector('input[name="p1-input"]:checked')?.value||"keyboard-mouse"}startGame(t,e,i="keyboard-mouse"){this.playerCount=t,this.isPlayer2AI=t===1,this.player1InputMethod=i,this.gameState="PLAYING",this.gameDuration=e,this.gameTimer=e,this.scores={p1:0,p2:0},this.players=[];const s=document.getElementById("menu");s&&(s.style.display="none"),this.soundManager.playBackgroundMusic("gameplay"),this.init()}init(){const t=this.player1InputMethod;this.players.push(new p(this,1,"red",!1,t)),this.isPlayer2AI?this.players.push(new p(this,2,"blue",!0,"ai")):this.players.push(new p(this,2,"blue",!1,"controller")),this.resetPositions()}resetPositions(){this.players[0].position={x:-150,y:0},this.players[1].position={x:150,y:0},this.players[0].velocity={x:0,y:0},this.players[1].velocity={x:0,y:0}}resize(){this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.arenaRadius=Math.min(this.width,this.height)*.4}start(){this.lastTime=performance.now(),this.soundManager.playBackgroundMusic("menu"),requestAnimationFrame(t=>this.loop(t))}loop(t){const e=(t-this.lastTime)/1e3;for(this.lastTime=t,this.accumulator+=e;this.accumulator>=this.step;)this.update(this.step),this.accumulator-=this.step;this.draw(),requestAnimationFrame(i=>this.loop(i))}update(t){if(this.gameState==="PLAYING"&&this.gameTimer>0&&(this.gameTimer-=t,this.gameTimer<=0)){this.gameTimer=0,this.checkGameEnd();return}if(this.gameState==="ROUND_END"){this.roundEndTimer-=t,this.roundEndTimer<=0&&this.startNextRound();return}if(this.gameState!=="GAME_END"){if(this.gameState==="TIEBREAKER"){this.players.forEach(e=>e.update(t)),this.projectiles.forEach((e,i)=>{e.update(t),e.shouldRemove&&this.projectiles.splice(i,1)}),this.physics.checkCollisions(),this.updateUI();return}this.gameState==="PLAYING"&&(this.playerCount===1&&this.checkPlayerControllerStatus(),this.players.forEach(e=>e.update(t)),this.projectiles.forEach((e,i)=>{e.update(t),e.shouldRemove&&this.projectiles.splice(i,1)}),this.physics.checkCollisions(),this.updateUI(),this.checkRoundEnd())}}checkRoundEnd(){const t=this.players.filter(e=>e.hp>0);t.length<=1&&(t.length===1?(this.roundWinner=t[0],this.roundWinner.isWinner=!0,this.lastWinnerId=this.roundWinner.id,this.roundWinner.id===1?this.scores.p1++:this.scores.p2++,console.log(`Player ${this.roundWinner.id} wins the round! Score: P1=${this.scores.p1}, P2=${this.scores.p2}`),this.soundManager.playWin()):(this.roundWinner=null,console.log("Round draw!")),this.gameState="ROUND_END",this.roundEndTimer=2)}checkGameEnd(){if(this.scores.p1===this.scores.p2)console.log("Scores tied! Starting tiebreaker mode!"),this.startTiebreaker();else{const t=this.scores.p1>this.scores.p2?this.players[0]:this.players[1];console.log(`Game over! Player ${t.id} wins with ${this.scores.p1} - ${this.scores.p2}!`),this.soundManager.playWin(),this.gameState="GAME_END",this.roundEndTimer=3,setTimeout(()=>this.resetGame(),3e3)}}startNextRound(){this.players.forEach(t=>{t.hp=10,t.isWinner=t.id===this.lastWinnerId,t.overheat=0,t.isOverheated=!1,t.canShoot=!0}),this.projectiles=[],this.resetPositions(),this.gameState="PLAYING",this.roundWinner=null,this.soundManager.playBackgroundMusic("gameplay")}startTiebreaker(){this.gameState="TIEBREAKER",this.isTiebreaker=!0,this.players.forEach(e=>{e.hp=1,e.canShoot=!1,e.isWinner=!1}),this.projectiles=[],this.resetPositions();const t=document.getElementById("tiebreaker-warning");t&&(t.style.opacity="1")}endTiebreaker(t){const e=this.players.find(s=>s.id!==t.id);e&&(console.log(`Tiebreaker: Player ${e.id} wins!`),this.soundManager.playWin());const i=document.getElementById("tiebreaker-warning");i&&(i.style.opacity="0"),this.gameState="GAME_END",setTimeout(()=>this.resetGame(),3e3)}resetGame(){this.players=[],this.projectiles=[],this.gameTimer=this.gameDuration,this.scores={p1:0,p2:0},this.isTiebreaker=!1,this.isSuddenDeath=!1,this.arenaRadius=Math.min(this.width,this.height)*.4,this.gameState="MENU",this.roundWinner=null,this.wasPlayer2ControllerConnected=!1;const t=document.getElementById("sudden-death-warning");t&&(t.style.opacity="0");const e=document.getElementById("tiebreaker-warning");e&&(e.style.opacity="0");const i=document.getElementById("menu");i&&(i.style.display="flex"),this.soundManager.playBackgroundMusic("menu")}checkPlayerControllerStatus(){if(this.playerCount!==1||!this.players[1])return;const t=this.inputManager.isControllerConnected(2);t&&!this.wasPlayer2ControllerConnected&&this.isPlayer2AI?(console.log("Player 2 controller detected! Hot-joining..."),this.players[1].switchToHuman("controller"),this.isPlayer2AI=!1,this.wasPlayer2ControllerConnected=!0):!t&&this.wasPlayer2ControllerConnected&&!this.isPlayer2AI?(console.log("Player 2 controller disconnected! AI taking over..."),this.players[1].switchToAI(),this.isPlayer2AI=!0,this.wasPlayer2ControllerConnected=!1):t!==this.wasPlayer2ControllerConnected&&(this.wasPlayer2ControllerConnected=t)}draw(){this.ctx.fillStyle="#111",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.save(),this.ctx.translate(this.width/2,this.height/2),this.renderer.drawArena(this.arenaRadius,this.isTiebreaker),this.players.forEach(t=>t.draw(this.renderer)),this.projectiles.forEach(t=>t.draw(this.renderer)),this.ctx.restore()}updateUI(){const t=document.getElementById("timer");if(t){const r=Math.floor(Math.max(0,this.gameTimer)/60).toString().padStart(2,"0"),h=Math.floor(Math.max(0,this.gameTimer)%60).toString().padStart(2,"0");t.innerText=`${r}:${h}`}const e=document.getElementById("p1-score"),i=document.getElementById("p2-score");e&&(e.innerText=this.scores.p1.toString()),i&&(i.innerText=this.scores.p2.toString());const s=document.getElementById("p1-health"),o=document.getElementById("p2-health"),n=s?.querySelector(".health-fill"),a=o?.querySelector(".health-fill");n&&this.players[0]&&(n.style.height=`${this.players[0].hp/10*100}%`),a&&this.players[1]&&(a.style.height=`${this.players[1].hp/10*100}%`)}}const b=document.getElementById("gameCanvas"),A=new P(b);A.start();
